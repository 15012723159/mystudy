# #短连接风暴
### 1.第一种方法：先处理掉那些占着连接但是不工作的线程。
### 2.**第二种方法：减少连接过程的消耗。
2.1跳过权限验证的方法是：重启数据库，并使用–skip-grant-tables参数启动。这样，整个MySQL会跳过所有的权限验证阶段，包括连接过程和语句执行过程在内。

但是，这种方法特别符合我们标题里说的“饮鸩止渴”，风险极高，是我特别不建议使用的方案。尤其你的库外网可访问的话，就更不能这么做了。

在MySQL 8.0版本里，如果你启用–skip-grant-tables参数，MySQL会默认把 --skip-networking参数打开，表示这时候数据库只能被本地的客户端连接。可见，MySQL官方对skip-grant-tables这个参数的安全问题也很重视。

除了短连接数暴增可能会带来性能问题外，实际上，我们在线上碰到更多的是查询或者更新语句导致的性能问题。其中，查询问题比较典型的有两类，一类是由新出现的慢查询导致的，一类是由QPS（每秒查询数）突增导致的。而关于更新语句导致的性能问题，我会在下一篇文章和你展开说明。
# 慢查询性能问题

在MySQL中，会引发性能问题的慢查询，大体有以下三种可能：

1.  索引没有设计好；
    
2.  SQL语句没写好；
    
3.  MySQL选错了索引。


# 慢查询性能问题

在MySQL中，会引发性能问题的慢查询，大体有以下三种可能：

1.  索引没有设计好；
    
2.  SQL语句没写好；
    
3.  MySQL选错了索引。
    

接下来，我们就具体分析一下这三种可能，以及对应的解决方案。

### 导致慢查询的第一种可能是，索引没有设计好。

这种场景一般就是通过紧急创建索引来解决。MySQL 5.6版本以后，创建索引都支持Online DDL了，对于那种高峰期数据库已经被这个语句打挂了的情况，最高效的做法就是直接执行alter table 语句。

比较理想的是能够在备库先执行。假设你现在的服务是一主一备，主库A、备库B，这个方案的大致流程是这样的：

1.  在备库B上执行 set sql_log_bin=off，也就是不写binlog，然后执行alter table 语句加上索引；
    
2.  执行主备切换；
    
3.  这时候主库是B，备库是A。在A上执行 set sql_log_bin=off，然后执行alter table 语句加上索引。
    

这是一个“古老”的DDL方案。平时在做变更的时候，你应该考虑类似gh-ost这样的方案，更加稳妥。但是在需要紧急处理时，上面这个方案的效率是最高的。